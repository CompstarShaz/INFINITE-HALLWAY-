<script>
document.getElementById('exportTxtBtn').onclick = () => {
  const rawText = resultsBox.textContent.trim();
  if (!rawText || rawText.startsWith('No')) {
    alert('No fleet numbers to export!');
    return;
  }

  let fleetList = rawText
    .split(/[\s,]+/)
    .map(x => x.trim().toUpperCase())
    .filter(x => x.length > 0);

  fleetList = [...new Set(fleetList)].sort((a, b) => a.localeCompare(b, undefined, { numeric: true }));

  const groups = {};
  fleetList.forEach(item => {
    const prefix = /^[A-Z]+/.exec(item)?.[0] || 'NUM';
    if (!groups[prefix]) groups[prefix] = [];
    groups[prefix].push(item);
  });

  let formattedText = `- Asset Locator App -\n(Clockwork Schedule Fleet Numbers)\n\nFleet.\n`;

  Object.keys(groups).sort().forEach(prefix => {
    formattedText += groups[prefix].map(n => n + ',').join('\n');
    formattedText += '\n\n';
  });

  const today = new Date();
  const dateStr = `${String(today.getDate()).padStart(2,'0')}-${String(today.getMonth()+1).padStart(2,'0')}-${today.getFullYear()}`;
  const fileName = `Clockwork_${dateStr}.txt`;

  const blob = new Blob([formattedText], { type: 'text/plain' });
  const link = document.createElement('a');
  link.download = fileName;
  link.href = URL.createObjectURL(blob);
  link.click();
};
</script>

<div style="text-align:center;">
<button id="exportTxtBtn"
style="
display:inline-flex;
align-items:center;
justify-content:center;
gap:12px;
padding:16px 28px;
font-size:20px;
font-weight:700;
background:#45004F40;
border:2px solid black;
border-radius:12px;
color:transparent;
background-clip:text;
-webkit-background-clip:text;
text-fill-color:transparent;
-webkit-text-fill-color:transparent;
background-image:linear-gradient(45deg, purple, #8AB7E3);
box-shadow:4px 8px 20px rgba(0,255,0,0.5);
cursor:pointer;
margin-top:20px;
transition:transform 0.5s ease;
flex-wrap:wrap;
"
onmouseover="this.style.transform='scale(1.25)'"
onmouseout="this.style.transform='scale(1)'"
>
  <div style="display:flex;flex-direction:column;align-items:center;line-height:1.1;">
    <h2 style="margin:0;font-size:22px;">Export As Text</h2>
    <h4 style="margin:0;font-size:15px;">Clockwork_[date].txt</h4>
  </div>
  <img src="assets/dldown.png" alt="Download" style="width:70px;height:80px;object-fit:contain;">
</button>
</div>